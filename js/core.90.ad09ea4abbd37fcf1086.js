(self.webpackChunk=self.webpackChunk||[]).push([[90],{30090:(e,t,n)=>{"use strict";n.d(t,{S1:()=>or});var r={}.hasOwnProperty;function a(e,t){return r.call(t,e)}function o(e,t){var n;return(n=[]).concat.apply(n,t.map(e))}var i=Array.isArray;function c(e){return"object"==typeof e&&null!==e&&!i(e)}function s(e,t){return Object.keys(t).reduce((function(n,r){return n[r]=e(t[r]),n}),{})}function u(e){return e}function d(){return Math.random().toString(36).substring(2)}function p(e){var t=d();return a(t,e)?p(e):t}function l(e,t){for(var n="string"==typeof e?e.split("."):e,r=0,a=t;a&&r<n.length;)a=a[n[r++]];return a}function f(e){return 0===(i(e)?e:Object.keys(e)).length}function v(){}function h(e,t){var n,r="function"==typeof e?e:function(t){return l(e,t)};return(i(t)?[].concat(t):(n=t,Object.keys(n).map((function(e){return n[e]})))).sort((function(e,t){return r(e)-r(t)}))}function _(e,t){return e.reduce((function(e,n){return a(n,t)&&(e[n]=t[n]),e}),{})}var m=function(e){return Object.keys(e).map((function(t){return[t,e[t]]}))};var g=function(e,t){return e===t?0:e<t?-1:1};function y(e,t){var n=[];return t.filter((function(t){var r=e(t);return-1===n.indexOf(r)&&(n.push(r),!0)}))}const I=function(){var e={};return e.promise=new Promise((function(t,n){e.resolve=t,e.reject=n})),e};var w=n(6680);var b=n(41041),T=(0,b.VS)()?window.localStorage:b.ZP;const k={setItem:function(e,t){return new Promise((function(n){return n(T.setItem(e,t))}))},getItem:function(e){return new Promise((function(t){return t(T.getItem(e))}))},removeItem:function(e){return new Promise((function(t){return t(T.removeItem(e))}))}};const E=function(e){return new Promise((function(t){t(e())}))};var S=n(19830),O=n.n(S),q=n(11904),C=function(e){return m(e).map((function(e){return e.map(encodeURIComponent).join("=")})).join("&")};var P=/[^:]+:\/\/[^(/|?)\s]+/,j=function(e){return e.replace(/\w/g,"$&[\\r\\n\\t]*")},x=(new RegExp("^[\0-]*("+j("javascript")+"|"+j("data")+"):","i"),n(20550)),N=n.n(x);function D(){return(D=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var M=n(55833).Z;const U=function(){var e=Object.create(null),t=M(e);return D({},t,{off:function(n,r){n?t.off(n,r):Object.keys(e).forEach((function(t){delete e[t]}))},once:function(e,n){t.on(e,(function r(a,o){t.off(e,r),n(a,o)}))}})};const A=function(e,t){var n,r=void 0===t?{}:t,a=r.query,o=r.transports,i=void 0===o?["websocket","xhr-polling"]:o,c=e+(a?"?"+C(a):""),s=U(),u=function(e){var t=e.min,n=void 0===t?1e3:t,r=e.max,a=void 0===r?5e3:r,o=e.jitter,i=void 0===o?.5:o,c=0;return{duration:function(){var e=n*Math.pow(2,c++);if(i){var t=Math.random(),r=Math.floor(t*i*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,a)},reset:function(){c=0}}}({min:1e3,max:5e3,jitter:.5}),d=3,p=null,l=function(){d=1,u.reset(),s.emit("connect")},f=function(){d=3,p=null,s.emit("disconnect"),g()},v=function(e){var t=e.data;s.emit("message",t)},h=function(){s.emit("heartbeat")},_=function(){var e;(d=3,p)&&((e=p).removeEventListener("open",l),e.removeEventListener("close",f),e.removeEventListener("message",v),e.removeEventListener("heartbeat",h),p.close(),p=null)},m=function(){var e;d=0,p=new(N())(c,void 0,{transports:i}),(e=p).addEventListener("open",l),e.addEventListener("close",f),e.addEventListener("message",v),e.addEventListener("heartbeat",h)},g=function(e){void 0===e&&(e=u.duration()),clearTimeout(n),0!==e?n=setTimeout(m,e):m()},y={connect:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){if(3!==d)throw new Error("Socket is already open or connecting.");clearTimeout(n),m()})),destroy:function(){y.off(),y.disconnect()},disconnect:function(){d=3,clearTimeout(n),_()},reconnect:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){_(),g(e)})),emit:function(e){if(1!==d)throw new Error("Socket is not connected.");p.send(e)},getReadyState:function(){return d},on:s.on,off:s.off};return y};function L(){return(L=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const F=function(e,t){var n,r,a,o,i,c=void 0===t?{}:t,s=c.query,u=void 0===s?{}:s,p=c.rescheduleTimeout,l=void 0===p?3e4:p,f=c.transports,h=c.emitter,_=void 0===h?U():h,m=A(e,{query:L({bh:d()},u),transports:f}),g=(a=v,{cancel:function(){clearTimeout(r),a=v},check:function(){var e=I();return a=e.resolve,r=setTimeout((function(){var t=new Error("Timeout.");t.code="TIMEOUT",e.reject(t)}),2e3),e.promise},resolve:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){clearTimeout(r),a()}))}),y=function(){return 1===m.getReadyState()},w=function(e){m.emit(JSON.stringify(e)),T()},b=function(){w({action:"ping"})},T=function(){clearTimeout(n),n=setTimeout(b,l)},k=function(){g.cancel(),clearTimeout(n)};return o=m,i=_,["connect","disconnect"].forEach((function(e){o.on(e,(function(t){i.emit(e,t)}))})),m.on("connect",T),m.on("disconnect",k),m.on("heartbeat",b),m.on("message",(function(e){g.resolve();var t=JSON.parse(e);"ping"!==t.action&&_.emit("message",t)})),"undefined"!=typeof window&&void 0!==window.addEventListener&&(window.addEventListener("online",(function(){y()&&(g.check().then((function(){g.cancel(),_.emit("connection_recovered")}),(function(e){if(g.cancel(),"TIMEOUT"!==e.code)throw e;m.reconnect()})),b())})),window.addEventListener("offline",(function(){g.cancel(),y()&&_.emit("connection_unstable")}))),L({},m,{destroy:function(){k(),m.destroy()},disconnect:function(){k(),m.disconnect()},reconnect:function(e){k(),m.reconnect(e)},emit:w,on:_.on,off:_.off})};var R="UPLOAD_FAILED";const H=function(e,t,n){var r=void 0===n?{}:n,a=r.headers,o=r.method,i=void 0===o?"POST":o,c=r.onProgress,s=r.withCredentials,u=void 0!==s&&s,d=new XMLHttpRequest;return{promise:new Promise((function(n,r){var o,s;"function"==typeof c&&(d.upload.onprogress=function(e){c(e.loaded/e.total)}),d.onload=function(){var e;try{e=JSON.parse(d.response)}catch(t){e=d.response}if(d.status>=200&&d.status<300)n(e);else{var t=new Error("Upload failed.");t.code=R,t.response=e,r(t)}},d.onerror=function(){var e=new Error("Upload failed.");e.code=R,r(e)},d.onabort=function(){var e=new Error("Upload canceled.");e.code="UPLOAD_CANCELED",r(e)},d.open(i,e),d.withCredentials=u,a&&Object.keys(a).forEach((function(e){return d.setRequestHeader(e,a[e])})),d.send((o=t,s=new FormData,Object.keys(o).forEach((function(e){return s.append(e,o[e])})),s))})),cancel:function(){d.abort()}}};document.documentElement.currentStyle;var G="https://accounts.livechatinc.com",z="@livechat/customer-auth",J="https://accounts.livechatinc.com",Z=function(e,t,n){var r,a,o,i;return""+("production"===n?J:J.replace("accounts.","accounts."+n+"."))+(a=(r=e).uniqueGroups,o=r.licenseId,i=r.groupId,(a?"/licence/g"+o+"_"+i:"")+"/customer")+"?"+C(function(e,t){var n=e.clientId,r=e.licenseId;return{license_id:String(r),flow:"button",response_type:"token",client_id:n,redirect_uri:t,post_message_uri:t,state:z}}(e,t))},B=function(e){var t=e.code,n=e.message,r=new Error(n);return r.code=t,r},V=function(e,t){var n,r,a=document.createElement("iframe");return a.style.display="none",a.setAttribute("src",Z(e,(n=String(window.location),((r=n.match(P))&&r[0])+window.location.pathname),t)),a},Y=function(e,t){var n=e.licenseId,r=function(e){return"production"===e?G:G.replace("accounts.","accounts."+e+".")}(t);return new Promise((function(a,o){var i=V(e,t),c=function(){var e,t;(t=(e=i).parentNode)&&t.removeChild(e),window.removeEventListener("message",u,!1)},s=setTimeout((function(){c(),o(B({message:"Request timed out.",code:"REQUEST_TIMEOUT"}))}),15e3),u=function(e){var t=e.origin,i=e.data;if(t===r&&function(e){return e&&e.state===z}(i)){clearTimeout(s),c();try{a(function(e,t){if("identity_exception"in e)throw B({code:"SSO_IDENTITY_EXCEPTION",message:e.identity_exception});if("oauth_exception"in e)throw B({code:"SSO_OAUTH_EXCEPTION",message:e.oauth_exception});return{accessToken:e.access_token,entityId:e.entity_id,expiresIn:1e3*e.expires_in,tokenType:e.token_type,creationDate:Date.now(),licenseId:t}}(i,n))}catch(e){o(e)}}};window.addEventListener("message",u,!1),new Promise((function(e){!function t(){document.body?e(document.body):setTimeout(t,100)}()})).then((function(e){e.appendChild(i)}))}))},X=function(e){var t=e.licenseId,n=e.clientId;if("number"!=typeof t||"string"!=typeof n)throw new Error("You need to pass valid configuration object: { licenseId, clientId }.")};const K=function(e,t){X(e);var n="@@lc_auth_token:"+e.licenseId+(e.uniqueGroups?":"+e.groupId:""),r=null,a=null,o=k.getItem(n).then((function(e){null!==o&&(o=null,e&&(a=JSON.parse(e)))})),i=function(){return r=Y(e,t).then((function(e){return r=null,k.setItem(n,JSON.stringify(e)),a=e,e}),(function(e){throw r=null,e}))};return{getFreshToken:i,getToken:function e(){return r||(a&&!function(e){var t=e.creationDate,n=e.expiresIn;return Date.now()>=t+n}(a)?Promise.resolve(a):o?o.then(e):i())},hasToken:function e(){return o?o.then(e):Promise.resolve(!!a)},invalidate:function(){return a=null,o=null,k.removeItem(n)}}};function Q(){return(Q=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function W(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}function $(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var ee="change_region",te="check_goals",ne="destroy",re="fail_all_requests",ae="login_success",oe="pause_connection",ie="prefetch_token",ce="push_received",se="push_response_received",ue="reconnect",de="request_failed",pe="response_received",le="send_request",fe="set_chat_active",ve="set_self_id",he="socket_connected",_e="socket_disconnected",me="socket_recovered",ge="socket_unstable",ye="start_connection",Ie="update_customer_page",we="CONNECTION_LOST",be="IDENTITY_MISMATCH",Te="MISDIRECTED_CONNECTION",ke="MISSING_CHAT_THREAD",Ee="accept_greeting",Se="activate_chat",Oe="cancel_greeting",qe="deactivate_chat",Ce="delete_chat_properties",Pe="delete_event_properties",je="delete_thread_properties",xe="get_chat",Ne="get_customer",De="get_form",Me="get_predicted_agent",Ue="get_url_info",Ae="list_chats",Le="list_group_statuses",Fe="list_threads",Re="login",He="mark_events_as_seen",Ge="send_event",ze="send_rich_message_postback",Je="send_sneak_peek",Ze="set_customer_session_fields",Be="start_chat",Ve="update_chat_properties",Ye="update_customer",Xe="update_customer_page",Ke="update_event_properties",Qe="update_thread_properties",We="connected",$e="destroyed",et="disconnected",tt="agent",nt="customer",rt=function(e){return e.connection.status},at=function(e,t){return e.requests[t]},ot=function(e){return e.users.self.id},it=function(e,t){var n=e.chats[t];return!!n&&n.active},ct=function(e){return rt(e)===We},st=function(e){var t=e.region;return"https://api"+(t?"-"+t:"")+function(e){var t=e.licenseId,n=e.env;return 1520===t?".staging":"production"===n?"":"."+n}(e)+".livechatinc.com"},ut=function(e){return st(e)+"/v3.2/customer"},dt=function(e,t){var n=t.id;return Q({},e,{requests:W(e.requests,[n].map($))})},pt=function(e,t){return Q({},t,{connection:Q({},t.connection,{status:e})})},lt=function(e){var t,n,r;return n=e,(t={}).change_region=function(e,t){return Q({},e,{region:t.region})},t.destroy=function(e){return pt($e,e)},t.login_success=function(e){return pt(We,e)},t.pause_connection=function(e){return pt("paused",e)},t.request_failed=dt,t.response_received=dt,t.send_request=function(e,t){var n,r=t.promise,a=t.resolve,o=t.reject,i=t.id,c=t.request;return Q({},e,{requests:Q({},e.requests,(n={},n[i]={id:i,promise:r,resolve:a,reject:o,request:c},n))})},t.set_chat_active=function(e,t){var n,r=t.id,a=t.active;return Q({},e,{chats:Q({},e.chats,(n={},n[r]=Q({},e.chats[r],{active:a}),n))})},t.set_self_id=function(e,t){return Q({},e,{users:Q({},e.users,{self:Q({},e.users.self,{id:t.id})})})},t.socket_disconnected=function(e){var t=rt(e);return Q({},pt(t===et?et:"reconnecting",e),{requests:{}})},t.update_customer_page=function(e,t){return Q({},e,{page:Q({},e.page,t)})},(r=t)[void 0]&&console.warn(["Reducer contains an 'undefined' action type.","Have you misspelled a constant?"].join("\n")),function(e,t){return void 0===e&&(e=n),a(t.type,r)?r[t.type](e,t.payload):e}};function ft(e){var t=u,n=function(){var e=[],t=function(t){return function(n){return function(r){var a=n(r);return e.forEach((function(e){e(r,t)})),a}}};return t.add=function(t){e.push(t)},t}(),r=(0,w.MT)(lt(function(e){var t=e.application,n=void 0===t?{}:t,r=e.licenseId,a=e.groupId,o=void 0===a?null:a,i=e.env,c=e.page,s=void 0===c?null:c,u=e.region,d=void 0===u?null:u,p=e.referrer,l=void 0===p?null:p,f=e.uniqueGroups,v=void 0!==f&&f,h=e.mobile,_=void 0!==h&&h;return{application:Q({},n,{name:"customer_sdk",version:"2.0.4"}),licenseId:r,env:i,groupId:o,chats:{},connection:{status:et},page:s,region:d,referrer:l,requests:{},users:{self:{id:null,type:nt},others:{}},uniqueGroups:v,mobile:_}}(e)),t((0,w.md)(n)));return r.addSideEffectsHandler=n.add,r}function vt(e){var t=e.message,n=e.code,r=new Error(t);return r.code=n,r}var ht="chat_deactivated",_t="customer_disconnected",mt="customer_side_storage_updated",gt="incoming_chat",yt="incoming_event",It="incoming_multicast",wt="incoming_typing_indicator",bt="queue_position_updated",Tt="thread_properties_updated",kt="user_added_to_chat",Et="user_removed_from_chat",St="file",Ot="filled_form",qt="message",Ct="rich_message",Pt="system_message",jt=function(e){var t={};return"string"==typeof e.customId&&(t.custom_id=e.customId),c(e.properties)&&(t.properties=e.properties),t},xt=function(e){switch(e.type){case qt:var t=Q({},jt(e),{type:e.type,text:e.text});return e.postback&&(t.postback={id:e.postback.id,thread_id:e.postback.threadId,event_id:e.postback.eventId,type:e.postback.type,value:e.postback.value}),t;case St:return Q({},jt(e),{type:e.type,url:e.url});case Ot:return Q({},jt(e),{type:e.type,form_id:e.formId,fields:e.fields.map((function(e){switch(e.type){case"group_chooser":if(!e.answer)return e;var t=e.answer,n=t.groupId;return Q({},e,{answer:Q({},W(t,["groupId"]),{group_id:n})});default:return e}}))});case Pt:var n=Q({},jt(e),{type:e.type,text:e.text,system_message_type:e.systemMessageType});return e.recipients&&(n.recipients=e.recipients),n}},Nt=function(e){var t=e.chat,n=e.continuous,r={chat:{}};if("boolean"==typeof n&&(r.continuous=n),!t)return r;var a=t.access,o=t.thread,i=t.properties;return a&&a.groupIds&&(r.chat.access={group_ids:a.groupIds}),i&&(r.chat.properties=i),o&&(r.chat.thread=function(e){var t={},n=e.events,r=e.properties;return n&&(t.events=n.map(xt)),r&&(t.properties=r),t}(o)),r},Dt=function(e){return m(e).map((function(e){var t,n=e[0],r=e[1];return(t={})[n]=r,t}))},Mt=function(e){var t=_(["avatar","name","email"],e);return e.sessionFields&&(t.session_fields=Dt(e.sessionFields)),t},Ut=function(e){return{type:ne,payload:{reason:e}}},At=function(e){return void 0===e&&(e=!1),{type:ie,payload:{fresh:e}}},Lt=function(e){return{type:ue,payload:{delay:e}}},Ft=function(e,t,n){return{type:le,payload:Q({request:{action:e,payload:t}},n&&{source:n})}},Rt=function(e,t){return{type:fe,payload:{id:e,active:t}}},Ht=function(e){return{type:ve,payload:{id:e}}},Gt=function(e,t){t.payload.id=p(e.getState().requests);var n=I(),r=n.resolve,a=n.reject,o=n.promise;return t.payload.promise=o,t.payload.resolve=r,t.payload.reject=a,e.dispatch(t),o},zt=function(e){var t=e.getState(),n=t.licenseId,r=t.groupId;return"side_storage_"+n+(t.uniqueGroups?":"+r:"")},Jt=function(e){return k.getItem(zt(e)).catch(v).then((function(e){return JSON.parse(e||"{}")})).catch((function(){return{}}))},Zt=function(e,t,n){return Gt(e,Ft(t,n,"login"))};function Bt(e,t){var n,r,a=null,o=new(O())({min:300,max:6e4,jitter:.3}),i=function(e){return n.dispatch(Ut(e))},c=function(){return n.dispatch(Lt(o.duration()))},s=function(){return Promise.all([e.getToken(),Jt(n)])},u=function(e){var t=e[0],r=e[1],a=ot(n.getState());if(null===a)n.dispatch(Ht(t.entityId));else if(a!==t.entityId){var o=new Error("Identity has changed.");throw o.code=be,o}return[t,r]},d=function(e){var r,o,i,c=e[0],s=e[1],u=n.getState(),d=u.application,p=u.groupId,l=u.page,f=u.referrer,v=u.mobile,h={token:c.tokenType+" "+c.accessToken,customer:"function"==typeof t?Mt(t()):{},customer_side_storage:s,is_mobile:v,application:(r=["name","version"],o=d,r.reduce((function(e,t){return e[t]=o[t],e}),{}))};return"number"==typeof p&&(h.group_id=p),d.channelType&&(h.application.channel_type=d.channelType),null!==l&&(a=l,h.customer_page=l),null!==f&&(h.referrer=f),Promise.race([Zt(n,Re,h),(i=15e3,new Promise((function(e){setTimeout(e,i)}))).then((function(){return Promise.reject(vt({message:"Request timed out.",code:"REQUEST_TIMEOUT"}))}))])};return function(t){n=t,r&&r.cancel(),r=function(e,t,n){var r=e.slice(0),a=!1;return function e(o){var i=r.shift();E((function(){return i(o)})).then((function(n){a||(r.length?e(n):t(n))}),(function(e){a||n(e)}))}(),{cancel:function(){a=!0}}}([s,u,d],(function(e){var t;r=null,o.reset(),t=n.getState().page,a!==t&&Zt(n,Xe,t).catch(v),a=null,n.dispatch({type:ae,payload:e})}),(function(t){switch(t.code){case"AUTHENTICATION":return e.getFreshToken(),void c();case we:case Te:return;case"SSO_IDENTITY_EXCEPTION":case"SSO_OAUTH_EXCEPTION":return"server_error"===t.message||"temporarily_unavailable"===t.message?void c():void i(t.message);case be:case"CUSTOMER_BANNED":case"USERS_LIMIT_REACHED":case"WRONG_PRODUCT_VERSION":return void i(t.code.toLowerCase());default:return void c()}}))}}var Vt,Yt=function(e,t){var n=e.getState,r=e.dispatch,a=function(e){return e.requests}(n());r({type:re,payload:{rejects:Object.keys(a).map((function(e){return a[e].reject})),reason:t}})},Xt=function(e,t,n){var r=e.getState,a=e.dispatch,o=t.payload.id;a({type:de,payload:{id:o,reject:r().requests[o].reject,error:n}})},Kt=Object.freeze({success:!0}),Qt=function(e,t){var n={id:t.id,authorId:t.author_id,createdAt:t.created_at,threadId:e,properties:t.properties||{}};return void 0!==t.custom_id&&(n.customId=t.custom_id),n},Wt=function(e,t){var n,r,a,o,i;t.height>t.width?(r="height",a="width",o=t.height,i=t.width):(r="width",a="height",o=t.width,i=t.height);var c=e/o;return(n={})[r]=Math.ceil(Math.min(o,e)),n[a]=Math.ceil(Math.min(c*i,i)),n},$t=function(e,t){return void 0!==t.width&&void 0!==t.height?function(e,t){return Q({},Qt(e,t),{type:St,contentType:t.content_type,url:t.url,name:t.name,width:t.width,height:t.height,thumbnails:{default:Q({url:t.thumbnail_url},Wt(300,t)),high:Q({url:t.thumbnail2x_url},Wt(600,t))}})}(e,t):Q({},Qt(e,t),{type:St,contentType:t.content_type,url:t.url,name:t.name})},en=function(e){var t={};if("string"==typeof e.title&&(t.title=e.title),"string"==typeof e.subtitle&&(t.subtitle=e.subtitle),e.image){var n=e.image;t.image={url:n.url,name:n.name}}return e.buttons&&(t.buttons=e.buttons.map((function(e){switch(e.type){case"message":case"phone":return{type:e.type,text:e.text,postbackId:e.postback_id,userIds:e.user_ids,value:e.value,role:e.role||"default"};case"url":var t={type:e.type,text:e.text,postbackId:e.postback_id,userIds:e.user_ids,value:e.value,role:e.role||"default"};return e.target&&(t.target=e.target),t;case"webview":var n={type:e.type,text:e.text,postbackId:e.postback_id,userIds:e.user_ids,value:e.value,role:e.role||"default"};return"string"==typeof e.webview_height&&(n.webviewHeight=e.webview_height),n;default:return{text:e.text,postbackId:e.postback_id,userIds:e.user_ids,role:e.role||"default"}}}))),t},tn=function(e,t){switch(t.type){case St:return $t(e,t);case Ot:return function(e,t){return Q({},Qt(e,t),{type:Ot,formId:t.form_id,fields:t.fields.map((function(e){switch(e.type){case"group_chooser":if(!e.answer)return e;var t=e.answer,n=t.group_id;return Q({},e,{answer:Q({},W(t,["group_id"]),{groupId:n})});default:return e}}))})}(e,t);case qt:return function(e,t){return Q({},Qt(e,t),{type:qt,text:t.text})}(e,t);case Ct:return function(e,t){switch(t.template_id){case"cards":case"quick_replies":case"sticker":return Q({},Qt(e,t),{type:Ct,template:t.template_id,elements:t.elements.map(en)});default:return null}}(e,t);case Pt:return function(e,t){var n=Q({},Qt(e,Q({},t,{author_id:"system"})),{type:Pt,text:t.text,systemMessageType:t.system_message_type});return t.text_vars&&(n.textVars=t.text_vars),n}(e,t);default:return null}},nn=function(e){return{id:e.id,addon:e.addon||null,uniqueId:e.unique_id,displayedFirstTime:e.displayed_first_time,accepted:e.accepted||!1,event:tn(null,e.event),agent:{id:e.agent.id,name:e.agent.name,avatar:e.agent.avatar,jobTitle:e.agent.job_title,isBot:e.agent.is_bot||!1}}},rn=function(e){return void 0===e&&(e={}),e.group_ids?{groupIds:e.group_ids}:{}},an=function(e){return s((function(e){return e.events_seen_up_to?e.events_seen_up_to:null}),(t="id",e.reduce((function(e,n){return e[n[t]]=n,e}),{})));var t},on=function(e,t){var n=t.properties||{};return{id:t.id,chatId:e,active:t.active,access:rn(t.access),createdAt:t.created_at,userIds:t.user_ids,events:t.events.map((function(e){return tn(t.id,e)})).filter(Boolean),properties:n,previousThreadId:t.previous_thread_id||null,nextThreadId:t.next_thread_id||null,queue:t.queue?ln(t.queue):null}},cn=function(e){return{id:e.id,access:rn(e.access),users:e.users.map(fn),properties:e.properties||{},thread:on(e.id,e.thread),eventsSeenUpToMap:an(e.users)}},sn=function(e){var t=_(["avatar","email","name"],e);return e.session_fields&&(t.sessionFields=e.session_fields.reduce((function(e,t){var n=Object.keys(t)[0];return e[n]=t[n],e}),{})),t},un=function(e){var t=sn(e);return Q({id:e.id,type:nt},t,{sessionFields:t.sessionFields||{}})},dn=function(e){var t=e.statistics;return Q({},un(e),{statistics:{chatsCount:t.chats_count,threadsCount:t.threads_count,visitsCount:t.visits_count,pageViewsCount:t.page_views_count,greetingsShownCount:t.greetings_shown_count,greetingsAcceptedCount:t.greetings_accepted_count}})},pn=function(e){return{position:e.position,waitTime:e.wait_time}},ln=function(e){return Q({},pn(e),{queuedAt:e.queued_at})},fn=function(e){return e.type===nt?Q({},un(n=e),{present:n.present}):{id:(t=e).id,type:tt,name:t.name,avatar:t.avatar,jobTitle:t.job_title,present:t.present};var t,n},vn=((Vt={}).CONNECTION_LOST="Connection lost.",Vt.MISDIRECTED_CONNECTION="Connected to wrong region.",Vt),hn=function(e,t){var n=e.getState();switch(t.type){case se:case ce:switch(t.payload.action){case ht:return void e.dispatch(Rt(t.payload.payload.chatId,!1));case gt:return void e.dispatch(Rt(t.payload.payload.chat.id,!0));default:return}case pe:switch(t.payload.action){case Ae:return void t.payload.payload.chatsSummary.filter((function(e){var t=e.id,r=e.active;return it(n,t)!==r})).forEach((function(t){var n=t.id,r=t.active;e.dispatch(Rt(n,r))}));default:return}}},_n=function(e,t){t.forEach((function(t){if("present"in t){var n=W(t,["present"]);e("user_data",n)}else if(t.type!==nt)e("user_data",t);else{var r=W(t,["statistics"]);e("user_data",r)}}))},mn=function(e,t){var n=e.emit,r=e.store,a=t.payload;switch(a.action){case Tt:return a.payload.properties.lc2&&"queue_pos"in a.payload.properties.lc2&&n(bt,{chatId:a.payload.chatId,threadId:a.payload.threadId,queue:{position:a.payload.properties.lc2.queue_pos,waitTime:a.payload.properties.lc2.queue_waiting_time}}),void n("thread_properties_updated",a.payload);case mt:return void function(e,t){k.setItem(zt(e),JSON.stringify(t)).catch(v)}(r,a.payload.customer_side_storage);case _t:switch(a.payload.reason){case"access_token_expired":r.dispatch(At(!0)),r.dispatch(Lt(100)),n("disconnected",a.payload);break;case"customer_banned":case"customer_temporarily_blocked":case"license_not_found":case"product_version_changed":case"too_many_connections":case"unsupported_version":r.dispatch(Ut(a.payload.reason));break;case"misdirected_connection":Yt(r,Te),r.dispatch({type:ee,payload:a.payload.data});break;case"too_many_unauthorized_connections":Yt(r,"TOO_MANY_UNAUTHORIZED_CONNECTIONS");break;default:r.dispatch(Lt(100)),n("disconnected",a.payload)}return;case gt:return _n(n,a.payload.chat.users),void n(a.action,a.payload);case yt:if(null===a.payload.event)return;return void n(a.action,a.payload);case wt:return void n(a.action,a.payload);case It:return function(e,t){var n=t.type,r=t.content;if("lc2"===n&&"groups_update"===r.name&&"groups"in r&&!f(r.groups)){e("availability_updated",{availability:"offline"===r.groups[0].status?"offline":"online"})}}(n,a.payload),void n(a.action,a.payload);case kt:return _n(n,[a.payload.user]),void n(a.action,a.payload);default:return void n(a.action,a.payload)}},gn=function(e,t){var n=e.emit,r=t.payload;switch(r.action){case ht:return void r.resolve(Kt);case xe:return _n(n,r.payload.users),void r.resolve(r.payload);case gt:return _n(n,r.payload.chat.users),void r.resolve(r.payload);case yt:return void r.resolve(r.payload.event);case Ae:return _n(n,r.payload.users),void r.resolve(r.payload);default:return void r.resolve(r.payload)}},yn=function(e){var t=e.auth,n=e.customerDataProvider,r=e.emitter,a=e.socket,o=r.emit,i=Bt(t,n);return function(e,n){switch(e.type){case ee:return void a.reinitialize();case te:return void function(e,t,n){return t.getToken().then((function(t){var r=e.getState();null===ot(r)&&e.dispatch(Ht(t.entityId));var a=r.page;if(a&&a.url){var o=C({license_id:r.licenseId}),i={customer_fields:n||{},session_fields:Dt(n||{}),group_id:r.groupId||0,page_url:a.url};return(0,q.Z)(ut(r)+"/action/check_goals?"+o,{method:"POST",headers:{"Content-Type":"application/json",Authorization:t.tokenType+" "+t.accessToken},body:JSON.stringify(i)}).then((function(){}))}}))}(n,t,e.payload.sessionFields).catch(v);case ne:var c=e.payload;return a.destroy(),"manual"!==c.reason&&o("disconnected",c),void r.off();case re:var s=e.payload,u=s.reason,d=s.rejects,p={message:vn[u],code:u};return void d.forEach((function(e){e(vt(p))}));case ae:var l=e.payload,f=l.dynamicConfig,h=l.customer,_=l.chats,m=l.greeting,g=Q({customer:h,availability:l.availability},m&&{greeting:m});return Object.defineProperty(g,"__unsafeDynamicConfig",{value:f}),Object.defineProperty(g,"__unsafeChats",{value:_}),void o("connected",g);case oe:return void a.disconnect();case ie:return e.payload.fresh?void t.getFreshToken().catch(v):void t.hasToken().then((function(e){return e?t.getToken().then((function(e){if(!(e.creationDate+e.expiresIn-Date.now()>36e5))return t.invalidate().then(t.getFreshToken)})):t.getToken()})).catch(v);case ce:return e.payload.action===_t||hn(n,e),void mn({emit:o,store:n},e);case se:return hn(n,e),void gn({emit:o},e);case ue:return void a.reconnect(e.payload.delay);case de:var y=e.payload;return void(0,y.reject)(vt(y.error));case pe:return hn(n,e),void gn({emit:o},e);case le:var I=n.getState();return function(e){return rt(e)===$e}(I)?void Xt(n,e,{code:"SDK_DESTROYED",message:"SDK destroyed."}):ct(I)||"login"===e.payload.source?void function(e,t){var n=t.payload,r=Q({request_id:n.id},n.request);e.emit(r)}(a,e):void Xt(n,e,{code:"NO_CONNECTION",message:"No connection."});case ve:return void o("customer_id",e.payload.id);case _e:return void o("disconnected",{reason:"connection_lost"});case he:return void i(n);case me:if(!ct(n.getState()))return;return void o("connection_recovered");case ge:if(!ct(n.getState()))return;return void o("connection_unstable");case ye:return a.connect(),void n.dispatch(At());case Ie:if(!ct(n.getState()))return;return void Gt(n,Ft(Xe,e.payload)).catch(v);default:return}}},In=function(e,t){var n=e.getState(),r=ut(n)+"/rtm/sjs";return F(r,{query:{license_id:n.licenseId},emitter:t})},wn=function(e){return{chatId:e.chat_id,properties:e.properties}},bn=function(e){var t={chatId:e.chat_id,threadId:e.thread_id,transferredTo:Q({},e.transferred_to.agent_ids&&{agentIds:e.transferred_to.agent_ids},e.transferred_to.group_ids&&{groupIds:e.transferred_to.group_ids}),queue:e.queue?ln(e.queue):null};return"manual"===e.reason?Q({},t,{reason:e.reason,requesterId:e.requester_id}):Q({},t,{reason:e.reason})},Tn=function(e){return{url:e.url,title:e.title,timestamp:1e3*e.timestamp}},kn=function(e){return{customer:Q({id:e.customer.id},sn(e.customer))}},En=function(e){return{chatId:e.chat_id,threadId:e.thread_id,eventId:e.event_id,properties:e.properties}},Sn=function(e){return{chatId:e.chat_id,threadId:e.thread_id,eventId:e.event_id,properties:e.properties}},On=function(e){var t=e.thread_id;return{chatId:e.chat_id,threadId:t,event:tn(t,e.event)}},qn=function(e){return{chatId:e.chat_id,userId:e.user_id,seenUpTo:e.seen_up_to}},Cn=function(e){return{uniqueId:e.unique_id}},Pn=function(e){return{chat:cn(e.chat)}},jn=function(e){return{chatId:e.chat_id,event:tn(e.thread_id,e.event)}},xn=function(e){return nn(e)},Nn=function(e){return{userId:e.user_id,chatId:e.chat_id,threadId:e.thread_id,eventId:e.event_id,postback:e.postback}},Dn=function(e){var t=e.chat_id,n=e.typing_indicator;return{chatId:t,typingIndicator:{authorId:n.author_id,isTyping:n.is_typing}}},Mn=function(e){return{chatId:e.chat_id,threadId:e.thread_id,queue:pn(e.queue)}},Un=function(e){return{chatId:e.chat_id,threadId:e.thread_id,properties:e.properties}},An=function(e){return{chatId:e.chat_id,threadId:e.thread_id,properties:e.properties}},Ln=function(e){return{chatId:e.chat_id,user:fn(e.user),present:e.user.present}},Fn=function(e){return{chatId:e.chat_id,userId:e.user_id}},Rn=function(e){return e.map((function(e){switch(e.type){case"group_chooser":return Q({},e,{options:e.options.map((function(e){var t=e.group_id;return Q({},W(e,["group_id"]),{groupId:t})}))});case"rating":var t=e.comment_label;return Q({},W(e,["comment_label"]),{commentLabel:t});default:return e}}))},Hn=function(e){return e.enabled?Q({},e,{form:"id"in e.form.fields[0]?{id:e.form.id,fields:Rn(e.form.fields)}:{id:"ticket",fields:(t=e.form.fields,n=t.map((function(e,t){return Q({},e,{id:String(t)})})),Rn(n))}}):e;var t,n},Gn=function(e){var t={url:e.url};return e.title&&(t.title=e.title),e.description&&(t.description=e.description),e.image_url&&(t.imageUrl="https://"+e.image_url,e.image_width&&e.image_height&&(t.imageWidth=e.image_width,t.imageHeight=e.image_height)),t},zn=function(e){var t=e.online_groups_ids,n=e.customer_groups;if(!t)return"offline";var r,a=n.monitoring.id;return r=a,-1!==t.indexOf(r)?"online":"offline"},Jn=function(e){var t=e.chats_summary.map((function(e){var t=e.id,n=e.active,r=e.access,a=e.last_thread_created_at,o=e.last_thread_id,i=e.last_event_per_type,c=e.properties,u=void 0===c?{}:c,d=e.users,p={id:t,active:n,access:rn(r),properties:u,users:d.map(fn),lastThreadId:o||null,lastThreadCreatedAt:a||null,eventsSeenUpToMap:an(d)};if(!i)return p;p.lastEventsPerType=s((function(e){return tn(e.thread_id,e.event)}),i);var l,f=i,v=Object.keys(f).map((function(e){return f[e]})),h=(l=v.sort((function(e,t){return e.thread_id===t.thread_id?g(e.event.created_at,t.event.created_at):g(e.thread_created_at,t.thread_created_at)}))).length>0?l[l.length-1]:null;return h&&(p.lastEvent=p.lastEventsPerType[h.event.type]),p}));return{chatsSummary:h((function(e){var t=e.lastEvent,n=e.order;return-1*(void 0!==t?t.timestamp:n)}),t),totalChats:e.total_chats,users:y((function(e){return e.id}),o((function(e){return e.users}),t)),previousPageId:e.previous_page_id||null,nextPageId:e.next_page_id||null}},Zn=function(e){return e.groups_status},Bn=function(e,t){return{threads:t.threads.map((function(t){return on(e.payload.chat_id,t)})),previousPageId:t.previous_page_id||null,nextPageId:t.next_page_id||null}},Vn=function(e){var t=e.__priv_dynamic_config,n=e.chats,r=e.greeting||t.greeting;return Q({dynamicConfig:t,customer:dn(e.customer),availability:zn(t),chats:n.map((function(t){return{id:t.chat_id,active:"has_active_thread"in t?t.has_active_thread:e.has_active_thread,hasUnreadEvents:t.has_unread_events}}))},r&&{greeting:nn(r)})},Yn=function(e){switch(e.action){case ht:return{action:e.action,payload:{chatId:e.payload.chat_id}};case"chat_properties_deleted":return{action:e.action,payload:(t=e.payload,{chatId:t.chat_id,properties:t.properties})};case"chat_properties_updated":return{action:e.action,payload:wn(e.payload)};case"chat_transferred":return{action:e.action,payload:bn(e.payload)};case mt:case _t:return{action:e.action,payload:e.payload};case"customer_page_updated":return{action:e.action,payload:Tn(e.payload)};case"customer_updated":return{action:e.action,payload:kn(e.payload)};case"event_properties_deleted":return{action:e.action,payload:En(e.payload)};case"event_properties_updated":return{action:e.action,payload:Sn(e.payload)};case"event_updated":return{action:e.action,payload:On(e.payload)};case"events_marked_as_seen":return{action:e.action,payload:qn(e.payload)};case"greeting_accepted":case"greeting_canceled":return{action:e.action,payload:Cn(e.payload)};case gt:return{action:e.action,payload:Pn(e.payload)};case yt:return{action:e.action,payload:jn(e.payload)};case"incoming_greeting":return{action:e.action,payload:xn(e.payload)};case It:return{action:e.action,payload:e.payload};case"incoming_rich_message_postback":return{action:e.action,payload:Nn(e.payload)};case wt:return{action:e.action,payload:Dn(e.payload)};case bt:return{action:e.action,payload:Mn(e.payload)};case"thread_properties_deleted":return{action:e.action,payload:Un(e.payload)};case Tt:return{action:e.action,payload:An(e.payload)};case kt:return{action:e.action,payload:Ln(e.payload)};case Et:return{action:e.action,payload:Fn(e.payload)};case"chat_user_added":return{action:kt,payload:Ln(e.payload)};case"chat_user_removed":return{action:Et,payload:Fn(e.payload)}}var t},Xn=function(e,t){var n=e.dispatch,r=e.getState,a=t.request_id,o=at(r(),a),i=o.promise,c=o.resolve,s=function(e){var t,n,r=e.request,a=e.response;switch(a.action){case Ee:case Oe:case Ce:case Pe:case je:return{action:a.action,payload:Kt};case xe:return{action:a.action,payload:(n=a.payload,cn(n))};case Ne:return{action:a.action,payload:dn(a.payload)};case De:return{action:a.action,payload:Hn(a.payload)};case Me:return{action:a.action,payload:(t=a.payload,{id:t.id,type:tt,name:t.name,avatar:t.avatar,jobTitle:t.job_title,isBot:t.is_bot})};case Ue:return{action:a.action,payload:Gn(a.payload)};case Ae:return{action:a.action,payload:Jn(a.payload)};case Le:return{action:a.action,payload:Zn(a.payload)};case Fe:return{action:a.action,payload:Bn(r,a.payload)};case Re:return{action:a.action,payload:Vn(a.payload)};case He:case Je:case Ze:case ze:case Ve:case Ye:case Xe:case Ke:case Qe:return{action:a.action,payload:Kt}}}({request:o.request,response:t});n({type:pe,payload:Q({id:a,promise:i,resolve:c},s)})},Kn=function(e,t){var n=e.dispatch;return t.on("connect",(function(){n({type:he})})),t.on("message",(function(t){if("response"===t.type){if(!t.success)return void function(e,t){var n,r=e.dispatch,a=e.getState,o=t.request_id,i=t.payload,c=at(a(),o).reject;r({type:de,payload:{id:o,reject:c,error:(n=i.error,{code:n.type.toUpperCase(),message:n.message})}})}(e,t);switch(t.action){case Se:case qe:case Ge:case Be:return;default:return void Xn(e,t)}}if("request_id"in t)switch(t.action){case ht:case gt:case yt:return void function(e,t){var n=e.dispatch,r=e.getState,a=t.request_id,o=at(r(),a),i=o.promise,c=o.resolve,s=Yn(t);n({type:se,payload:Q({id:a,promise:i,resolve:c},s)})}(e,t)}!function(e,t){var n=Yn(t);n&&e.dispatch({type:ce,payload:n})}(e,t)})),t.on("disconnect",(function(){Yt(e,we),rt(e.getState())===We&&e.dispatch({type:_e})})),t.on("connection_unstable",(function(){n({type:ge})})),t.on("connection_recovered",(function(){n({type:me})})),t.off},Qn="incorrect requester structure",Wn=function(e,t){return e.length?e+"\n"+t:t},$n=function(e,t,n){var r=n.filledForm,a=n.groupId,o=n.timeZone;return t.getToken().then((function(t){var n=e.getState();null===ot(n)&&e.dispatch(Ht(t.entityId));var i=st(n)+"/v2/tickets/new",c=function(e,t){var n=t.fields,r=t.customerId,a=t.groupId,o=void 0===a?e.groupId:a,i=t.timeZone,c=Q({licence_id:e.licenseId,ticket_message:"",offline_message:"",visitor_id:r,requester:{}},"number"==typeof o&&{group:o},e.page&&{source:{url:e.page.url}},i&&{timezone:i});return n.reduce((function(e,t){switch(t.type){case"subject":var n=t.answer,r=n?t.label+" "+n:t.label;return n&&(e.subject=n),e.offline_message=Wn(e.offline_message,r),e;case"name":var a=t.answer,o=a?t.label+" "+a:t.label;return a&&(e.requester.name=a),e.offline_message=Wn(e.offline_message,o),e;case"email":var i=t.answer,c=i?t.label+" "+i:t.label;return e.requester.mail=i,e.offline_message=Wn(e.offline_message,c),e;case"question":case"textarea":var s=t.answer,u=s?t.label+" "+s:t.label;return e.offline_message=Wn(e.offline_message,u),e.ticket_message=Wn(e.ticket_message,u),e;case"radio":case"select":var d=t.answer&&t.answer.label,p=d?t.label+" "+d:t.label;return e.offline_message=Wn(e.offline_message,p),e.ticket_message=Wn(e.ticket_message,p),e;case"checkbox":var l=t.answers&&t.answers.map((function(e){return e.label})).join(", "),f=l?t.label+" "+l:t.label;return e.offline_message=Wn(e.offline_message,f),e.ticket_message=Wn(e.ticket_message,f),e;default:return e}}),c)}(n,{fields:r.fields,customerId:t.entityId,groupId:a,timeZone:o});return(0,q.Z)(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}).then((function(e){if(e.ok)return e.json().then((function(e){return Q({},e,{text:c.ticket_message})}));if(400===e.status||422===e.status){var t=function(e){if(!e||!e.errors)throw new Error;var t=e.errors[0];if(Object.keys(t)[0]===Qn)throw vt({message:t[Qn][0],code:"VALIDATION"});throw new Error};return e.json().then(t,t)}throw new Error}))}))},er=1048576,tr=10485760,nr=function(e,t){if(void 0===t&&(t=2),e<1024)return e+" b";var n=e/1024;if(e<er)return n.toFixed(t)+" kb";var r=n/1024;return e<1073741824?r.toFixed(t)+" MB":(r/1024).toFixed(t)+" GB"},rr=function(e,t){var n,r=e.auth,a=e.store,o=t.file,i=t.onProgress,c=!1;return{promise:new Promise((function(e,t){!function(e){if(e.size>tr)throw vt({message:"The file is too big (max size is "+nr(tr)+").",code:"TOO_BIG_FILE"})}(o);var s=a.getState(),u=C({license_id:s.licenseId}),d=ut(s)+"/action/upload_file?"+u,p={file:o};r.getToken().then((function(r){c?t(new Error("Upload cancelled.")):(n=H(d,p,{headers:{Authorization:r.tokenType+" "+r.accessToken},onProgress:i})).promise.then(e,(function(e){if(e.response){var n=e.response.error,r=n.type,a=n.message;t(vt({message:a,code:r.toUpperCase()}))}else t(e)}))}))})),cancel:function(){c||(c=!0,n&&n.cancel())}}},ar=function(e){var t=e.env,n=e.licenseId,r=e.eventName;if("production"!==t)return Promise.resolve();var a={event_name:r,severity:"Informational",sdkVersion:"2.0.4"},o={licence_id:n,event_id:"chat_widget_customer_sdk",message:JSON.stringify(a)};return function(e,t){return new Promise((function(n){var r=new Image;r.src=e+"?"+t,r.onerror=v,r.onload=function(){return n()}}))}("https://queue.livechatinc.com/logs",C(o))},or=function(e,t){void 0===t&&(t="production"),X(e);var n=e.autoConnect,r=void 0===n||n,a=e.customerDataProvider,o=W(e,["autoConnect","customerDataProvider"]),i=ft(Q({},o,{env:t})),c=U(),s=function(e){var t=U(),n=In(e,t);return Q({},Object.keys(n).reduce((function(e,t){return e[t]=function(){var e;return(e=n)[t].apply(e,arguments)},e}),{}),{reinitialize:function(){n.disconnect(),(n=In(e,t)).connect()}})}(i),u=K(o,t);i.addSideEffectsHandler(yn({emitter:c,socket:s,auth:u,customerDataProvider:a})),Kn(i,s);var d=Gt.bind(null,i),p=function(){i.dispatch({type:ye})},l=Object.freeze({acceptGreeting:function(e){var t=e.greetingId,n=e.uniqueId;return d(Ft(Ee,{greeting_id:t,unique_id:n}))},activateChat:function(n){return ar({env:t,licenseId:e.licenseId,eventName:"chat_started"}),d(Ft(Se,function(e){var t=Nt(e);return Q({},t,{chat:Q({},t.chat,{id:e.chat.id})})}(n)))},auth:u,cancelGreeting:function(e){var t=e.uniqueId;return d(Ft(Oe,{unique_id:t}))},cancelRate:function(e){var t=e.chatId,n=e.properties,r=void 0===n?["score"]:n;return l.listThreads({chatId:t}).then((function(e){var n=e.threads;if(!n.length)throw vt({message:'There is no thread in "'+t+'".',code:ke});return l.deleteThreadProperties({chatId:t,threadId:n[0].id,properties:{rating:r}})}))},connect:p,deactivateChat:function(e){var t=e.chatId;return d(Ft(qe,{chat_id:t}))},deleteChatProperties:function(e){var t=e.chatId,n=e.properties;return d(Ft(Ce,{chat_id:t,properties:n}))},deleteEventProperties:function(e){var t=e.chatId,n=e.threadId,r=e.eventId,a=e.properties;return d(Ft(Pe,{chat_id:t,thread_id:n,event_id:r,properties:a}))},deleteThreadProperties:function(e){var t=e.chatId,n=e.threadId,r=e.properties;return d(Ft(je,{chat_id:t,thread_id:n,properties:r}))},destroy:function(){i.dispatch(Ut("manual"))},disconnect:function(){i.dispatch({type:oe})},getChat:function(e){var t=e.chatId,n=e.threadId;return d(Ft(xe,{chat_id:t,thread_id:n}))},getChatHistory:function(e){var t=e.chatId;return function(e,t){var n={status:"idle",queuedTasks:[],nextPageId:null},r=function r(a,o){switch(n.status){case"idle":return n.status="fetching",void e.listThreads({chatId:t,minEventsCount:25,pageId:n.nextPageId||void 0}).then((function(e){var t=e.threads,o=e.nextPageId;n.nextPageId=o,n.nextPageId?(n.status="idle",a({value:{threads:[].concat(t).reverse()},done:!1})):(n.status="done",a({value:{threads:[].concat(t).reverse()},done:!0}));var i=n.queuedTasks.shift();i&&r(i.resolve,i.reject)}),(function(e){var t=n.queuedTasks;n.status="idle",n.queuedTasks=[],o(e),t.forEach((function(t){return t.reject(e)}))}));case"fetching":return void n.queuedTasks.push({resolve:a,reject:o});case"done":return void a({value:void 0,done:!0})}};return{next:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){return new Promise(r)}))}}(l,t)},getCustomer:function(){return d(Ft(Ne,{}))},getForm:function(e){var t=e.groupId,n=e.type;return d(Ft(De,{group_id:t,type:n}))},getPredictedAgent:function(e){void 0===e&&(e={});var t=e.groupId;return d(Ft(Me,"number"==typeof t?{group_id:t}:{}))},getUrlInfo:function(e){var t=e.url;return d(Ft(Ue,{url:t}))},listChats:function(e){var t=void 0===e?{}:e,n=t.limit,r=void 0===n?10:n,a=t.pageId;return r>25?Promise.reject(new Error("Specified limit is too high (max 25).")):d(Ft(Ae,{limit:r,page_id:a}))},listGroupStatuses:function(e){var t=(void 0===e?{}:e).groupIds;return d(Ft(Le,t?{group_ids:t}:{all:!0}))},listThreads:function(e){var t=e.chatId,n=e.sortOrder,r=void 0===n?"desc":n,a=e.limit,o=e.pageId,i=e.minEventsCount;return d(Ft(Fe,{chat_id:t,sort_order:r,limit:a,page_id:o,min_events_count:i}))},markEventsAsSeen:function(e){var t=e.chatId,n=e.seenUpTo;return d(Ft(He,{chat_id:t,seen_up_to:n}))},on:c.on,once:c.once,off:c.off,rateChat:function(e){var t=e.chatId,n=e.rating;return l.listThreads({chatId:t}).then((function(e){var r=e.threads;if(!r.length)throw vt({message:'There is no thread in "'+t+'".',code:ke});return l.updateThreadProperties({chatId:t,threadId:r[0].id,properties:{rating:n}})}))},sendEvent:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return d(function(e){var t=e.chatId,n=e.event,r=e.attachToLastThread,a={chat_id:t,event:xt(n)};return r&&(a.attach_to_last_thread=!0),Ft(Ge,a)}(e))})),sendTicketForm:function(e){return $n(i,u,e)},sendRichMessagePostback:function(e){var t=e.chatId,n=e.threadId,r=e.eventId,a=e.postback;return d(Ft(ze,{chat_id:t,event_id:r,thread_id:n,postback:a}))},setCustomerSessionFields:function(e){var t=e.sessionFields;return d(Ft(Ze,{session_fields:Dt(t)}))},setSneakPeek:function(e){var t=e.chatId,n=e.sneakPeekText,r=i.getState();it(r,t)&&ct(r)&&d(Ft(Je,{chat_id:t,sneak_peek_text:n})).catch(v)},startChat:function(n){return void 0===n&&(n={}),ar({env:t,licenseId:e.licenseId,eventName:"chat_started"}),d(Ft(Be,Nt(n)))},updateChatProperties:function(e){var t=e.chatId,n=e.properties;return d(Ft(Ve,{chat_id:t,properties:n}))},updateCustomer:function(e){return d(Ft(Ye,Mt(e)))},updateCustomerPage:function(e){i.dispatch({type:Ie,payload:_(["title","url"],e)})},updateEventProperties:function(e){var t=e.chatId,n=e.threadId,r=e.eventId,a=e.properties;return d(Ft(Ke,{chat_id:t,event_id:r,thread_id:n,properties:a}))},updateThreadProperties:function(e){var t=e.chatId,n=e.threadId,r=e.properties;return d(Ft(Qe,{chat_id:t,thread_id:n,properties:r}))},uploadFile:function(e){return rr({auth:u,store:i},e)}});return r?p():i.dispatch({type:te,payload:{sessionFields:"function"==typeof a?a().sessionFields:{}}}),l}}}]);